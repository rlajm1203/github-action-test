name: ë””ìŠ¤ì½”ë“œ ë©”ì„¸ì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸

on:
  push:
      branches:
        - main

jobs:
  send-message:
    runs-on: ubuntu-latest
    steps:
      - name: GitHub ì—ì„œ ë ˆí¬ ë°›ì•„ì˜¤ê¸°
        uses: actions/checkout@v3

      - name: ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ ë³´ë‚´ê¸°
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          BRANCH_NAME: ${{ github.ref_name }}
          WORKFLOW_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          TIMESTAMP: ${{ github.event.repository.updated_at }}
          ENVIRONMENT: ${{ inputs.environment }}
        run: |
          COMMIT_MESSAGE=$(echo "$COMMIT_MESSAGE" | sed ':a;N;$!ba;s/\n/\\n/g')

          # JSON Payload ìƒì„±
          DATA=$(cat <<EOF
          {
            "username": "ğŸ””ë°°í¬ ì•Œë¦¬ë¯¸ğŸ””",
            "avatar_url": "https://i.namu.wiki/i/X6s5AIfkjae-h54b7EkMYVg7ityFni1B-YIhtck0g6P914sJTsjykJDEbrsoZdV8rmwmrcyioAH3d2CxLmjxLx20dpHZI1izwMjfs7Dvtuchchyt2HDu7iQyy02_QaU6b8RrxWBt4G0PMQ0IZTykpQ.webp",
            "embeds": [
              {
                "title": "ğŸ‰ğŸ‰ë°°í¬ê°€ ì„±ê³µí–ˆë‹¤~ğŸ‰ğŸ‰",
                "description" : "ì–¼ë¥¸ ì¼í•´ë¼~",
                "type": "rich",
                "color": 123456,
                "author": {
                  "name": "ë‚˜ëª…í™˜ êµìˆ˜ë‹˜",
                  "icon_url": "https://stat.jnu.ac.kr/upload/profInfo/1400527816183_1.jpg"
                },
                "fields": [
                  {
                    "name": "ì»¤ë°‹ ë©”ì‹œì§€",
                    "value": "\`$COMMIT_MESSAGE\`",
                    "inline": false
                  },
                  {
                    "name": "ë¸Œëœì¹˜",
                    "value": "\`$BRANCH_NAME\`",
                    "inline": false
                  },
                  {
                    "name": "ë°°í¬ í™˜ê²½",
                    "value": "\`$ENVIRONMENT\`",
                    "inline": false
                  },    
                  {
                    "name": "GitHub Actions",
                    "value": "[ë°°í¬ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸]($WORKFLOW_URL)",
                    "inline": false
                  }
                ]
              }
            ]
          }
          EOF
          )

          # JSON ë°ì´í„° ì¶œë ¥ (ë””ë²„ê¹… ìš©ë„)
          echo "===== JSON PAYLOAD ====="
          echo "$DATA"
          echo "========================"

          # Discord Webhook í˜¸ì¶œ
          curl -X POST -H "Content-Type: application/json" -d "$DATA" "$DISCORD_WEBHOOK_URL"