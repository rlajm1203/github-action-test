name: ë””ìŠ¤ì½”ë“œ ë©”ì„¸ì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸

on:
  push:
      branches:
        - main
env:
  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}

jobs:
  send-message:
    runs-on: ubuntu-latest
    steps:

      - name: ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ ë³´ë‚´ê¸°
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          BRANCH_NAME: ${{ github.head_ref }}
          WORKFLOW_URL: ${{ github.event.workflow_url }}
          TIMESTAMP: ${{ github.event.repository.updated_at }}
        run: |
                  # JSON Payload ìƒì„±
                  DATA=$(cat <<EOF
                  {
                    "username": "ğŸ””ë°°í¬ ì•Œë¦¬ë¯¸ğŸ””",
                    "avatar_url": "https://i.namu.wiki/i/X6s5AIfkjae-h54b7EkMYVg7ityFni1B-YIhtck0g6P914sJTsjykJDEbrsoZdV8rmwmrcyioAH3d2CxLmjxLx20dpHZI1izwMjfs7Dvtuchchyt2HDu7iQyy02_QaU6b8RrxWBt4G0PMQ0IZTykpQ.webp",
                    "embeds": [
                      {
                        "title": "ğŸ‰ğŸ‰ë°°í¬ê°€ ì„±ê³µí–ˆì–´ìš”~!ğŸ‰ğŸ‰",
                        "description" : "ë°°í¬ ì•Œë¦¼ì´ ë„ì°©í–ˆì–´ìš”~",
                        "type": "rich",
                        "color": 123456,
                        "author": {
                          "name": "ì¹ ê°€ì´",
                          "icon_url": "https://i.namu.wiki/i/X6s5AIfkjae-h54b7EkMYVg7ityFni1B-YIhtck0g6P914sJTsjykJDEbrsoZdV8rmwmrcyioAH3d2CxLmjxLx20dpHZI1izwMjfs7Dvtuchchyt2HDu7iQyy02_QaU6b8RrxWBt4G0PMQ0IZTykpQ.webp"
                        },
                        "fields": [
                          {
                            "name": "  ",
                            "value": "  ",
                            "inline": false
                          },    
                          {
                            "name": "ì»¤ë°‹ ë©”ì‹œì§€",
                            "value": "\`$COMMIT_MESSAGE\`",
                            "inline": false
                          },
                          {
                            "name": "  ",
                            "value": "  ",
                            "inline": false
                          },    
                          {
                            "name": "ë¸Œëœì¹˜",
                            "value": "\`$BRANCH_NAME\`",
                            "inline": false
                          },
                          {
                            "name": "  ",
                            "value": "  ",
                            "inline": false
                          },    
                          {
                            "name": "ë°°í¬ í™˜ê²½",
                            "value": "\`Dev\`",
                            "inline": false
                          },
                          {
                            "name": "  ",
                            "value": "  ",
                            "inline": false
                          },    
                          {
                            "name": "GitHub Actions",
                            "value": "[ë°°í¬ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸]($WORKFLOW_URL)",
                            "inline": false
                          }
                        ],
                        "footer": {
                          "text": "ë°°í¬ ì‹œê°",
                          "icon_url": "https://cdn-icons-png.flaticon.com/512/25/25231.png"
                        },
                        "timestamp": "$TIMESTAMP"
                      }
                    ]
                  }
                  EOF
                  )

                  # JSON ë°ì´í„° ì¶œë ¥ (ë””ë²„ê¹… ìš©ë„)
                  echo "===== JSON PAYLOAD ====="
                  echo "$DATA"
                  echo "========================"

                  # Discord Webhook í˜¸ì¶œ
                  curl -X POST -H "Content-Type: application/json" -d "$DATA" "$DISCORD_WEBHOOK_URL"